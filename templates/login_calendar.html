<!DOCTYPE html>
<html lang='ja'>
<head>
    <meta charset='utf-8'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <meta name='viewport' content='width=device-width, initial-scale=1'>

    <title>管理者ページ</title>

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

<!--    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/4.2.0/bootstrap/main.min.css" integrity="sha256-auNBxJ+1OpvUJfYRsPihqLzJFUM9D3gpb8nOh5v0LiM=" crossorigin="anonymous" />-->

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fullcalendar/core@4.3.1/main.min.css">

    <style type='text/css'>

    </style>

</head>

<body style='padding-top:4.5rem;'>
<nav class='navbar fixed-top navbar-expand-xl navbar-dark bg-info'>
    <button class='navbar-toggler' type='button' data-toggle='collapse' data-target='#navbarNavDropdown' aria-controls='navbarNavDropdown' aria-expanded='false' aria-label='Toggle navigation'>
        <span class='navbar-toggler-icon'></span>
    </button>
    <div class='collapse navbar-collapse' id='navbarNavDropdown'>
        <ul class='navbar-nav mr-auto'>
            <li class='nav-item actice'><a class='nav-link' href='../calendar'><i class='fas fa-layer-group fa-fw'></i>予定表</a></li>
            <li class='nav-item'><a class='nav-link' href='../login'><i class="fas fa-seedling"></i>メニュー</a></li>
        </ul>
        <ul class='navbar-nav'>
            <li class='nav-item'><a class='nav-link' href='../user'><i class='fas fa-user-cog fa-fw'></i>ユーザー設定</a></li>
            <li class='nav-item'><a class='nav-link' href='../system'><i class='fas fa-cog fa-fw'></i>システム設定</a></li>
        </ul>
    </div>
</nav>


<!-- 情報表示用ダイアログ -->
<div id='calendar'></div>


<!-- jQuery first, then Popper.js, then Bootstrap JS -->

<script src="https://code.jquery.com/jquery-3.4.1.js" integrity="sha256-WpOohJOqMqqyKL9FccASB9O0KwACQJpFTUBLTYOVvVU=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/moment.min.js" integrity="sha256-4iQZ6BVL4qNKlQ27TExEhBN1HFPvAvAMbFavKKosSWQ=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.9.0/fullcalendar.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar-scheduler/1.9.4/scheduler.min.js"></script>


<script>
    $(function(){
		let today = moment().format('YYYY-MM-DD HH:mm');
        console.log('today: ', today);

        let table = 'reservation';

        //DBから予約データを取得する処理
        $.ajax({
            'type': 'GET',
            'url': 'http://127.0.0.1:5000/get_db',
            'data': {
                'table': table
            }
        }).then(function(response){
            console.log('ajax response: ', response);

            let datas = [];
            for(let i=0; i<response.data.length; i++){
                let data = {};
                moment.defaultFormat = 'YYYY-MM-DD HH:mm';
                data['id'] = response.data[i][0];
                data['title'] = response.data[i][1];

                let startTime = moment(response.data[i][3]);
                data['start'] = startTime;

                let endTime = startTime.clone();
                endTime.add(3, 'hours');
                data['end'] = endTime;

                datas.push(data);
            }
            console.log('ajax datas: ', datas);

            $('#calendar').fullCalendar({
                schedulerLicenseKey: 'GPL-My-Project-Is-Open-Source',
                resourceAreaWidth: '100%',
                defaultDate: today,
                //defaultView: 'timelineDay',
                editable: true,
                allDaySlot: true,
                slotEventOverlap: false,
                eventDurationEditable: false,
                droppable: true,
                selectable: true,
                selectHelper: true,
                select: function(start, end, allDay){
                    console.log('fullcalendar select start: ', start);
                    console.log('fullcalendar select end: ', end);
                    console.log('fullcalendar select allDay: ', allDay);
                    alert('select Clicked!');
                },
                eventClick: function(calEvent, jsEvent, view){
                    console.log('fullcalendar eventClick calEvent: ', calEvent);
                    console.log('fullcalendar eventClick jsEvent: ', jsEvent);
                    console.log('fullcalendar eventClick view: ', view);
                    alert('event Clicked!');
                },
                header: {
                    left: 'prev,next today',
                    center: 'title',
                    right: 'dayGridMonth,timeGridWeek,timeGridDay'
                },
                events: datas,
<!--                events: [{-->
<!--                        id: '1',-->
<!--                        resourceId: 'a',-->
<!--                        start: '2019-12-2',-->
<!--                        end: '2019-12-5',-->
<!--                        title: '耕転'-->
<!--                    },{-->
<!--                        id: '2',-->

<!--                        start: '2019-12-7',-->
<!--                        end: '2019-12-10',-->
<!--                        title: '種まき'-->
<!--                    }-->
<!--                ],-->

<!--            Views: {-->
<!--                    timelineThreeDays: {-->
<!--                        type: 'timeline',-->
<!--                        duration: {-->
<!--                            days: 3-->
<!--                        }-->
<!--                    }-->
<!--            },-->
<!--            resourceLabelText: 'Farms',-->
<!--            resources: [{-->
<!--                    id: 'a',-->
<!--                    title: 'okura'-->
<!--                },-->
<!--                {-->
<!--                    id: 'b',-->
<!--                    title: 'speamint'-->
<!--                }],-->
            });

        }, function(error){
            console.log('ajax error: ', error);
        });


    });
</script>
</body>
</html>
